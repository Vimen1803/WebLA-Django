<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel</title>
  <link rel="icon" href="https://pbs.twimg.com/profile_images/1234206824125124610/VVfVRa2r_400x400.jpg">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      overflow: auto;
    }
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
      color: #333; /* Default text color for light mode */
    }
    body.dark-mode {
      background: linear-gradient(135deg, #1a202c, #2d3748);
      color: #e2e8f0; /* Text color for dark mode */
    }
    .btn {
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-primary,
    .btn-primary-lo{
      background: #3b82f6;
      color: white;
    }
    .btn-primary:hover,
    .btn-primary-lo:hover {
      background: #2563eb;
    }
    .btn-secondary {
      background: #6b7280;
      color: white;
    }
    .btn-secondary:hover {
      background: #4b5563;
    }
    .btn-danger {
      background: #ef4444;
      color: white;
    }
    .btn-danger:hover {
      background: #dc2626;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 50;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: white;
      padding: 2rem;
      border-radius: 0.5rem;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 20px 25px rgba(0,0,0,0.1);
    }
    body.dark-mode .modal-content {
      background: #2d3748;
      color: #e2e8f0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 0.75rem 1rem;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
    }
    body.dark-mode th, body.dark-mode td {
      border-bottom: 1px solid #4a5568;
    }
    th {
      background: #f9fafb;
      font-weight: 600;
      color: #374151;
    }
    body.dark-mode th {
      background: #4a5568;
      color: #e2e8f0;
    }
    .console-output {
      background: #1f2937;
      color: #e5e7eb;
      padding: 1rem;
      border-radius: 0.375rem;
      font-family: monospace;
      height: 100%;
      overflow-y: auto;
      overflow-x: hidden;
      white-space: pre-wrap;
    }
    .left-panel, .right-panel {
      overflow-y: auto;
      background: white; /* Default background for panels */
    }
    body.dark-mode .left-panel, body.dark-mode .right-panel {
      background: #2d3748; /* Dark mode background for panels */
    }
    body.dark-mode .text-gray-800 {
      color: #e2e8f0;
    }
    body.dark-mode .text-gray-700 {
      color: #cbd5e0;
    }
    body.dark-mode .text-gray-500 {
      color: #a0aec0;
    }
    body.dark-mode .border-gray-300 {
      border-color: #4a5568;
    }
    body.dark-mode input, body.dark-mode select {
      background-color: #4a5568;
      color: #e2e8f0;
    }
    body.dark-mode input::placeholder {
      color: #a0aec0;
    }
    .right-panel {
      display: flex;
      flex-direction: column;
    }
    #console-output {
      flex-grow: 1;
      min-height: 0;
    }
    /* Modal alerta personalizado */
    #alert-modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
    }
    #alert-modal.show {
      display: flex;
    }
    #alert-modal .modal-content {
      max-width: 400px;
      padding: 1.5rem;
      text-align: center;
      position: relative;
    }
    #alert-message {
      margin-bottom: 1rem;
      font-weight: 600;
      color: #111;
    }
    body.dark-mode #alert-message {
      color: #e2e8f0;
    }
    /* Modal confirmación */
    #confirm-modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1100;
      display: none;
      align-items: center;
      justify-content: center;
    }
    #confirm-modal .modal-content {
      max-width: 400px;
      padding: 1.5rem;
      text-align: center;
      position: relative;
    }
    body.dark-mode #confirm-modal .modal-content p {
      color: #e2e8f0;
    }

    /* Scrollbar para WebKit (Chrome, Safari, Edge) */
    .left-panel::-webkit-scrollbar,
    .right-panel::-webkit-scrollbar {
      width: 12px;
    }

    .left-panel::-webkit-scrollbar-track,
    .right-panel::-webkit-scrollbar-track {
      background: #f3f4f6; /* color claro para el track en modo claro */
      border-radius: 6px;
    }

    .left-panel::-webkit-scrollbar-thumb,
    .right-panel::-webkit-scrollbar-thumb {
      background-color: #9ca3af; /* gris medio para thumb en modo claro */
      border-radius: 6px;
      border: 3px solid #f3f4f6; /* espacio alrededor para dar efecto */
    }

    /* Scrollbar para Firefox */
    .left-panel,
    .right-panel {
      scrollbar-width: thin;
      scrollbar-color: #9ca3af #f3f4f6;
    }

    /* Modo oscuro */
    body.dark-mode .left-panel::-webkit-scrollbar-track,
    body.dark-mode .right-panel::-webkit-scrollbar-track {
      background: #1a202c; /* fondo oscuro para track */
    }

    body.dark-mode .left-panel::-webkit-scrollbar-thumb,
    body.dark-mode .right-panel::-webkit-scrollbar-thumb {
      background-color: #4a5568; /* gris oscuro para thumb */
      border: 3px solid #1a202c;
    }

    body.dark-mode .left-panel,
    body.dark-mode .right-panel {
      scrollbar-color: #4a5568 #1a202c;
    }

@media (max-width: 1257px) {
  body {
    flex-direction: column !important;
    overflow-x: hidden !important;
  }
  .left-panel,
  .right-panel {
    width: 100% !important;
    flex-shrink: 0 !important;
    margin: 0 0 1rem 0 !important;
    overflow: hidden !important;
  }
  .left-panel {
    order: 1;
    height: 400px !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
  }
  .right-panel {
    order: 2;
    height: 600px !important;
    display: flex;
    flex-direction: column;
    overflow-x: hidden;
  }
  #console-output {
    flex-grow: 1 !important;
    height: auto !important;
    min-height: 0 !important;
    overflow-y: auto !important;
  }
  .left-panel table {
    table-layout: auto !important;
    width: 100% !important;
    word-break: break-word !important;
  }
  .left-panel th,
  .left-panel td {
    font-size: 0.85rem !important;
    padding: 0.4rem !important;
    white-space: normal !important;
    overflow-x: hidden;
  }
  .left-panel th:nth-child(3),
  .left-panel td:nth-child(3) { width: 120px !important; }
  .left-panel th:nth-child(1),
  .left-panel td:nth-child(1) { width: 80px !important; }
  .left-panel td .flex {
    flex-direction: column !important;
    align-items: center !important;
  }
  .left-panel td button span { display: none !important; }
  .left-panel td svg { width: 20px !important; height: 20px !important; }

  /* Botón reload más pequeño y centrado */
  #reload-form {
    display: flex;
    justify-content: center;
    margin-bottom: 1rem;
  }
  #reload-form button[type="submit"] {
    width: 150px;
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
  }

  /* Altura fija para filas y celdas de la tabla con truncado */
  .left-panel table tbody tr {
    height: 58px;
    max-height: 58px;
  }
  .left-panel table tbody tr td {
    height: 58px !important;
    max-height: 58px !important;
  }
  .left-panel table tbody tr td,
  .left-panel table thead tr th {
    height: 48px;
    max-height: 48px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    vertical-align: middle;
  }
}
  </style>
</head>
<body class="flex h-screen p-4 bg-gray-100">
  <!-- Left Panel -->
  <div class="left-panel w-1/2 flex flex-col bg-white rounded-lg shadow-lg p-6 mr-4 h-full">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-2xl font-bold text-gray-800">CLUBS TABLE</h2>
      <form id="reload-form" method="POST" action="{% url 'admin_view' %}">
        {% csrf_token %}
        <input type="hidden" name="action" value="reload">
        <button type="submit" class="btn btn-primary flex items-center space-x-2"> {{ fecha.date  }}
          <p></p>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99" />
          </svg>
        </button>
      </form>
    </div>
    <div class="flex-grow overflow-auto">
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Tag</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="table-body">
          {% for club in clubs_list %}
          <tr>
            <td>{{ club.name }}</td>
            <td>{{ club.tag }}</td>
            <td class="flex space-x-2">
              <button class="btn btn-secondary" onclick="openEditModal('{{ club.name|escapejs }}', '{{ club.tag|escapejs }}')" style="display: flex;">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                </svg>
                 <span>­ ­ Editar</span>
              </button>
              <button class="btn btn-danger" onclick="confirmDelete('{{ club.tag|escapejs }}')" style="display: flex;">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                </svg>
                <span>­ ­ Eliminar</span>
              </button>
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="3" class="text-center text-gray-500">No hay clubs.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <button class="btn btn-primary mt-4 flex items-center justify-center space-x-2" onclick="openAddModal()">
      <span>Añadir</span>
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
      </svg>
    </button>
  </div>

  <!-- Right Panel -->
  <div class="right-panel w-1/2 bg-white rounded-lg shadow-lg p-6 ml-4 h-full overflow-y-auto flex flex-col">
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-2xl font-bold text-gray-800">Consola</h2>
    <div class="flex items-center space-x-2"> {# Contenedor para los botones de navegación #}
      <!-- Botón de inicio -->
      <a href="{% url 'logout' %}" class="btn btn-primary-lo flex items-center justify-center p-2" title="Ir a inicio">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75" />
        </svg>
      </a>
      <!-- Botón de alternar modo oscuro/diurno -->
      <button id="theme-toggle" class="btn btn-secondary flex items-center justify-center p-2" title="Alternar modo oscuro/diurno">
        <!-- Icono de sol (modo diurno) -->
        <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-6.364-.386 1.591-1.591M3 12h2.25m-.386-6.364 1.591 1.591M12 12a3 3 0 1 1 0-6 3 3 0 0 1 0 6Z" />
        </svg>
        <!-- Icono de luna (modo oscuro) -->
        <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 hidden">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25c0 5.385 4.365 9.75 9.75 9.75 2.012 0 3.847-.647 5.385-1.752Z" />
        </svg>
      </button>
    </div>
  </div>

    <form id="console-form" method="POST" action="{% url 'admin_view' %}" class="mb-4" enctype="multipart/form-data"> {# Añadir enctype="multipart/form-data" #}
      {% csrf_token %}
      <input type="hidden" name="action" value="" id="console-action" />
      <div class="mb-4">
        <label for="console-select" class="block text-gray-700 text-sm font-bold mb-2">Selecciona Opción:</label>
        <select id="console-select" name="opcion" class="block w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
          <option value="club">Club</option>
          <option value="user">User</option>
        </select>
      </div>
      <div class="mb-4">
        <label for="console-tag" class="block text-gray-700 text-sm font-bold mb-2">Tag:</label>
        <input type="text" id="console-tag" name="tag" class="block w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Escribe el tag aquí..." />
      </div>
      <div class="flex gap-4 mb-4">
        <button type="submit"
          class="btn btn-primary w-1/2 transition duration-200 ease-in-out hover:bg-blue-600 hover:shadow-md flex items-center justify-center space-x-2"
          onclick="clearConsoleAction()">
          <span>Ejecutar Función</span>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
              stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.042 21.672 13.684 16.6m0 0-2.51 2.225.569-9.47 5.227 7.917-3.286-.672Zm-7.518-.267A8.25 8.25 0 1 1 20.25 10.5M8.288 14.212A5.25 5.25 0 1 1 17.25 10.5" />
          </svg>
        </button>
        <button type="button" onclick="resetConsole()"
          class="btn btn-secondary w-1/2 transition duration-200 ease-in-out hover:bg-gray-600 hover:shadow-md flex items-center justify-center space-x-2">
          <span>Reset</span>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
              stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 0 0-3.7-3.7 48.678 48.678 0 0 0-7.324 0 4.006 4.006 0 0 0-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 0 0 3.7 3.7 48.656 48.656 0 0 0 7.324 0 4.006 4.006 0 0 0 3.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3-3 3" />
          </svg>
        </button>
      </div>
    </form>

    <pre class="console-output flex-grow" id="console-output">{{ console }}</pre>
  </div>

  <!-- Add Modal -->
  <div id="add-modal" class="modal">
    <div class="modal-content">
      <h3 class="text-xl font-bold mb-4">Añadir Nuevo Club</h3>
      <form id="add-form" method="POST" action="{% url 'admin_view' %}">
        {% csrf_token %}
        <input type="hidden" name="action" value="add" />
        <label class="block mb-2 text-gray-700 font-bold">
          Name:
          <input type="text" name="name" id="add-name" class="block w-full mt-1 px-3 py-2 border border-gray-300 rounded-md" required />
        </label>
        <label class="block mb-4 text-gray-700 font-bold">
          Tag:
          <input type="text" name="tag" id="add-tag" class="block w-full mt-1 px-3 py-2 border border-gray-300 rounded-md" required />
        </label>
        <div class="flex justify-end space-x-2">
          <button type="button" class="btn btn-secondary" onclick="closeModals()" style="display: flex;">Cancelar
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
            </svg>
          </button>
          <button type="submit" class="btn btn-primary" style="display: flex;">Guardar
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z" />
            </svg>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Edit Modal -->
  <div id="edit-modal" class="modal">
    <div class="modal-content">
      <h3 class="text-xl font-bold mb-4">Editar Club</h3>
      <form id="edit-form" method="POST" action="{% url 'admin_view' %}">
        {% csrf_token %}
        <input type="hidden" name="action" value="edit" />
        <input type="hidden" name="original_tag" id="edit-original-tag" />
        <label class="block mb-2 text-gray-700 font-bold">
          Name:
          <input type="text" name="name" id="edit-name" class="block w-full mt-1 px-3 py-2 border border-gray-300 rounded-md" required />
        </label>
        <label class="block mb-4 text-gray-700 font-bold">
          Tag:
          <input type="text" name="tag" id="edit-tag" class="block w-full mt-1 px-3 py-2 border border-gray-300 rounded-md" required />
        </label>
        <div class="flex justify-end space-x-2">
          <button type="button" class="btn btn-secondary" onclick="closeModals()" style="display: flex;">Cancelar
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
          </svg>
          </button>
          <button type="submit" class="btn btn-primary" style="display: flex;">Guardar
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z" />
            </svg>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal de confirmación -->
  <div id="confirm-modal" class="modal">
    <div class="modal-content">
      <p style="margin-bottom: 1rem; font-weight: 600;">¿Seguro que quieres continuar?</p>
      <div class="flex justify-center gap-4">
        <button id="confirm-yes-btn" class="btn btn-primary" style="min-width: 100px;">Sí</button>
        <button id="confirm-no-btn" class="btn btn-secondary" style="min-width: 100px;">No</button>
      </div>
    </div>
  </div>

  <!-- Modal de alerta personalizado -->
  <div id="alert-modal" class="modal">
    <div class="modal-content">
      <p id="alert-message"></p>
      <button id="alert-close-btn" class="btn btn-primary" style="min-width: 100px;">Cerrar</button>
    </div>
  </div>

  <script>
    // Función para aplicar el tema
    function applyTheme(theme) {
      const body = document.body;
      const sunIcon = document.getElementById('sun-icon');
      const moonIcon = document.getElementById('moon-icon');

      if (theme === 'dark') {
        body.classList.add('dark-mode');
        sunIcon.classList.add('hidden');
        moonIcon.classList.remove('hidden');
      } else {
        body.classList.remove('dark-mode');
        sunIcon.classList.remove('hidden');
        moonIcon.classList.add('hidden');
      }
    }

    // Cargar el tema guardado al cargar la página
    document.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme) {
        applyTheme(savedTheme);
      } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        // Si no hay tema guardado, usar la preferencia del sistema
        applyTheme('dark');
      } else {
        applyTheme('light'); // Por defecto, modo claro
      }

      // Event listener para el botón de alternar tema
      const themeToggleBtn = document.getElementById('theme-toggle');
      if (themeToggleBtn) {
        themeToggleBtn.addEventListener('click', () => {
          const body = document.body;
          if (body.classList.contains('dark-mode')) {
            applyTheme('light');
            localStorage.setItem('theme', 'light');
          } else {
            applyTheme('dark');
            localStorage.setItem('theme', 'dark');
          }
        });
      }
    });

    // Abrir modales añadir y editar
    function openAddModal() {
      document.getElementById('add-name').value = '';
      document.getElementById('add-tag').value = '';
      document.getElementById('add-modal').style.display = 'flex';
    }

    function openEditModal(name, tag) {
      document.getElementById('edit-name').value = name;
      document.getElementById('edit-tag').value = tag;
      document.getElementById('edit-original-tag').value = tag;
      document.getElementById('edit-modal').style.display = 'flex';
    }

    function closeModals() {
      document.getElementById('add-modal').style.display = 'none';
      document.getElementById('edit-modal').style.display = 'none';
    }

    // Cerrar modales al hacer click fuera
    window.onclick = function(event) {
      const addModal = document.getElementById('add-modal');
      const editModal = document.getElementById('edit-modal');
      const alertModal = document.getElementById('alert-modal');
      const confirmModal = document.getElementById('confirm-modal');
      if (event.target === addModal) closeModals();
      if (event.target === editModal) closeModals();
      if (event.target === alertModal) closeAlertModal();
      if (event.target === confirmModal) closeConfirmModal();
    }

    // Reset consola
    function resetConsole() {
      const output = document.getElementById('console-output');
      const waitingMessage = { message: "Waiting for the request..." };
      output.textContent = JSON.stringify(waitingMessage, null, 2);
      document.getElementById('console-tag').value = '';
      document.getElementById('console-select').value = 'club';
    }

    const select = document.getElementById('console-select');
    const input = document.getElementById('console-tag');

    // Recuperar valores guardados al cargar la página
    const savedSelect = localStorage.getItem('selectedConsole');
    const savedTag = localStorage.getItem('consoleTag');

    if (savedSelect) select.value = savedSelect;
    if (savedTag) input.value = savedTag;

    // Guardar select y limpiar tag si cambia
    select.addEventListener('change', () => {
      localStorage.setItem('selectedConsole', select.value);
      input.value = ''; // borra el tag
      localStorage.removeItem('consoleTag'); // opcional: borrar también del localStorage
    });

    // Guardar el valor del input al escribir
    input.addEventListener('input', () => {
      localStorage.setItem('consoleTag', input.value);
    });

    function clearConsoleAction() {
      document.getElementById('console-action').value = '';
    }

    // Modal alerta
    function showAlert(message) {
      const modal = document.getElementById('alert-modal');
      const msgElem = document.getElementById('alert-message');
      const closeBtn = document.getElementById('alert-close-btn');

      msgElem.textContent = message;
      modal.style.display = 'flex';

      function closeModal() {
        modal.style.display = 'none';
        closeBtn.removeEventListener('click', closeModal);
      }

      closeBtn.addEventListener('click', closeModal);
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
      });
    }

    function closeAlertModal() {
      const modal = document.getElementById('alert-modal');
      modal.style.display = 'none';
    }

    // Modal confirmación
    const confirmModal = document.getElementById('confirm-modal');
    const confirmYesBtn = document.getElementById('confirm-yes-btn');
    const confirmNoBtn = document.getElementById('confirm-no-btn');
    let formToSubmit = null;

    function openConfirmModal(message, form) {
      confirmModal.querySelector('p').textContent = message;
      formToSubmit = form;
      confirmModal.style.display = 'flex';
    }

    function closeConfirmModal() {
      confirmModal.style.display = 'none';
      formToSubmit = null;
    }

    confirmYesBtn.addEventListener('click', () => {
      if (formToSubmit) formToSubmit.submit();
      closeConfirmModal();
    });

    confirmNoBtn.addEventListener('click', () => {
      closeConfirmModal();
    });

    // Interceptar añadir/editar
    const addForm = document.getElementById('add-form');
    const editForm = document.getElementById('edit-form');

    if (addForm) {
      addForm.addEventListener('submit', function(event) {
        event.preventDefault();
        openConfirmModal('¿Seguro que quieres añadir este club?', addForm);
      });
    }

    if (editForm) {
      editForm.addEventListener('submit', function(event) {
        event.preventDefault();
        openConfirmModal('¿Seguro que quieres guardar los cambios?', editForm);
      });
    }

    // Confirmación eliminar
    function confirmDelete(tag) {
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = "{% url 'admin_view' %}";

      const csrfToken = '{{ csrf_token }}';
      const csrfInput = document.createElement('input');
      csrfInput.type = 'hidden';
      csrfInput.name = 'csrfmiddlewaretoken';
      csrfInput.value = csrfToken;
      form.appendChild(csrfInput);

      const actionInput = document.createElement('input');
      actionInput.type = 'hidden';
      actionInput.name = 'action';
      actionInput.value = 'delete';
      form.appendChild(actionInput);

      const tagInput = document.createElement('input');
      tagInput.type = 'hidden';
      tagInput.name = 'tag';
      tagInput.value = tag;
      form.appendChild(tagInput);

      document.body.appendChild(form);
      openConfirmModal('¿Seguro que quieres eliminar este club?', form);
    }

    // Mostrar alertas siempre que haya status + message
    document.addEventListener('DOMContentLoaded', () => {
      try {
        const consoleData = JSON.parse(`{{ console|escapejs }}`);
        if (consoleData.status && consoleData.message) {
          showAlert(consoleData.message);
        }
      } catch (e) {
        console.error('Error parsing console JSON:', e);
      }
    });

    // --- MOVER BOTONES ENTRE PANELES EN MÓVIL ---
  document.addEventListener("DOMContentLoaded", () => {
    const leftHeader = document.querySelector(".left-panel .flex.items-center.justify-between");
    const rightHeader = document.querySelector(".right-panel .flex.items-center.space-x-2");

    const reloadForm = document.getElementById('reload-form');
    const logoutBtn = rightHeader?.querySelector('a[href*="logout"]');
    const themeBtn = rightHeader?.querySelector('#theme-toggle');

    if (!leftHeader || !rightHeader) return;

    function moveButtons() {
      if (window.innerWidth <= 1257) {
        if (reloadForm && reloadForm.parentElement !== rightHeader) {
          rightHeader.appendChild(reloadForm);
        }
        if (logoutBtn && logoutBtn.parentElement !== leftHeader) {
          leftHeader.appendChild(logoutBtn);
        }
        if (themeBtn && themeBtn.parentElement !== leftHeader) {
          leftHeader.appendChild(themeBtn);
        }
      } else {
        if (reloadForm && reloadForm.parentElement !== leftHeader) {
          leftHeader.appendChild(reloadForm);
        }
        if (logoutBtn && logoutBtn.parentElement !== rightHeader) {
          rightHeader.appendChild(logoutBtn);
        }
        if (themeBtn && themeBtn.parentElement !== rightHeader) {
          rightHeader.appendChild(themeBtn);
        }
      }
    }

    moveButtons();
    window.addEventListener("resize", moveButtons);
  });
  </script>
</body>
</html>